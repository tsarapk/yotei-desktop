<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:views="clr-namespace:YoteiTasks.Views"
        xmlns:viewModels="clr-namespace:YoteiTasks.ViewModels"
        xmlns:models="clr-namespace:YoteiTasks.Models"
        mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="800"
        x:Class="YoteiTasks.MainWindow"
        x:DataType="viewModels:MainViewModel"
        Title="YoteiTasks"
        Width="1200" Height="800">
    
    <Grid>
        <!-- User info bar at the top -->
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="250" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>
        
        <Border Grid.Row="0" Grid.ColumnSpan="2" Background="#1E1E1E" Padding="10,5">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Spacing="15">
                <TextBlock Text="{Binding CurrentActorName}" 
                           VerticalAlignment="Center" 
                           Foreground="White" />
                <Button Content="Ð’Ñ…Ð¾Ð´" 
                        Command="{Binding ShowLoginCommand}"
                        IsVisible="{Binding !IsLoggedIn}"
                        Padding="15,5" />
                <Button Content="Ð’Ñ‹Ñ…Ð¾Ð´" 
                        Command="{Binding LogoutCommand}"
                        IsVisible="{Binding IsLoggedIn}"
                        Padding="15,5" />
            </StackPanel>
        </Border>
        
        <!-- Main content area (Ð½Ðµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Ð½Ð°Ð¿Ñ€ÑÐ¼ÑƒÑŽ, Ð¾ÑÑ‚Ð°Ð²Ð»ÐµÐ½ Ð´Ð»Ñ ÑÐ¾Ð²Ð¼ÐµÑÑ‚Ð¸Ð¼Ð¾ÑÑ‚Ð¸ Ñ ÐºÐ¾Ð´Ð¾Ð¼) -->
        <ContentControl x:Name="MainContent" Grid.Row="1" Grid.ColumnSpan="2" />

        <!-- ÐŸÐ°Ð½ÐµÐ»ÑŒ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ð³Ñ€Ð°Ñ„Ð°Ð¼Ð¸ -->
        <Border Grid.Row="1" Grid.Column="0" Background="#141414" BorderBrush="#3F3F46" BorderThickness="0,0,1,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº Ð¸ ÐºÐ½Ð¾Ð¿ÐºÐ¸ -->
                <StackPanel Grid.Row="0" Margin="10" Spacing="10">
                    <TextBlock Text="ÐŸÑ€Ð¾ÐµÐºÑ‚Ñ‹" FontSize="18" FontWeight="Bold" Foreground="White" />
                    <Button Content="+ ÐÐ¾Ð²Ñ‹Ð¹ Ð¿Ñ€Ð¾ÐµÐºÑ‚" 
                            Command="{Binding AddGraphCommand}"
                            IsEnabled="{Binding CanCreateProjects}"
                            HorizontalAlignment="Stretch" />
                    <Button Content="âœï¸ Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ" 
                            Command="{Binding EditProjectCommand}"
                            HorizontalAlignment="Stretch" />
                    <Button Content="ðŸ—‘ï¸ Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ Ð¿Ñ€Ð¾ÐµÐºÑ‚" 
                            Command="{Binding DeleteProjectCommand}"
                            HorizontalAlignment="Stretch" />
                </StackPanel>

                <!-- Ð¡Ð¿Ð¸ÑÐ¾Ðº Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð¾Ð² -->
                <ListBox Grid.Row="1" 
                         ItemsSource="{Binding Projects}"
                         SelectedItem="{Binding SelectedProject}"
                         Margin="10,0,10,10">
                    <ListBox.ItemTemplate>
                        <DataTemplate x:DataType="models:Project">
                            <TextBlock Text="{Binding Name}" 
                                     Foreground="White" 
                                     Padding="5"
                                     VerticalAlignment="Center" />
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                    <ListBox.Styles>
                        <Style Selector="ListBoxItem:selected">
                            <Setter Property="Background" Value="#0078D4" />
                        </Style>
                        <Style Selector="ListBoxItem">
                            <Setter Property="Background" Value="Transparent" />
                            <Setter Property="Foreground" Value="White" />
                        </Style>
                        <Style Selector="ListBoxItem:pointerover">
                            <Setter Property="Background" Value="#3F3F46" />
                        </Style>
                    </ListBox.Styles>
                </ListBox>
            </Grid>
        </Border>

        <Grid Grid.Row="1" Grid.Column="1" Background="#141414">
            <Grid.RowDefinitions >
                <RowDefinition Height="50"/>
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="360" />
            </Grid.ColumnDefinitions>
            
            <!-- ÐŸÐ°Ð½ÐµÐ»ÑŒ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð² -->
            <Border Grid.Row="0" 
                    Grid.ColumnSpan="2"
                    Background="#141414"
                    BorderBrush="#3F3F46"
                    BorderThickness="0 0 0 1"
                    Padding="10,5"
                    IsVisible="{Binding SelectedGraph}"
                    >
                <StackPanel Orientation="Horizontal" Spacing="10">
                    <Button Content="Ð¥Ð¾Ð»ÑÑ‚" 
                            Command="{Binding ShowProjectsCommand}"
                            Foreground="White" 
                            VerticalAlignment="Center" />
                    <Button Content="Ð¡Ð¿Ð¸ÑÐ¾Ðº" 
                            Command="{Binding ShowTaskListCommand}"
                            Foreground="White" 
                            VerticalAlignment="Center" />
                    <Button Content ="Ð ÐµÑÑƒÑ€ÑÑ‹" 
                            Command="{Binding ShowResourcesCommand}"
                            Foreground="White" 
                            VerticalAlignment="Center" />
                    <Button Content="Ð˜ÑÐ¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»Ð¸" 
                            Command="{Binding ShowActorsCommand}"
                            Foreground="White" 
                            VerticalAlignment="Center" />        
                    <Button Content="Ð Ð¾Ð»Ð¸" 
                            Command="{Binding ShowRolesCommand}"
                            Foreground="White" 
                            VerticalAlignment="Center" />        
                </StackPanel>
            </Border>

            <!-- Ð Ð¾Ð»Ð¸ -->
            <Border Grid.Row="1" Grid.ColumnSpan="2"
                    Background="#141414"
                    Padding="10"
                    ZIndex="1000"
                    IsVisible="{Binding IsRolesTab}">
                <StackPanel Spacing="10">
                    <StackPanel Orientation="Horizontal" Spacing="10">
                        <TextBlock Text="Ð Ð¾Ð»Ð¸" FontSize="18" FontWeight="Bold" Foreground="White" />
                        <Button Content="+ Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ñ€Ð¾Ð»ÑŒ"
                                Command="{Binding AddRoleCommand}"
                                IsEnabled="{Binding CanCreateRoles}" />
                    </StackPanel>

                    <ListBox ItemsSource="{Binding Roles}">
                        <ListBox.ItemTemplate>
                            <DataTemplate x:DataType="viewModels:RoleViewModel">
                                <Border BorderBrush="#3F3F46" 
                                        BorderThickness="0,0,0,1" 
                                        Padding="0,10"
                                        Margin="0,0,0,5">
                                    <StackPanel Spacing="8">
                                        <TextBox Text="{Binding Name, Mode=TwoWay}"
                                                 Watermark="Ð˜Ð¼Ñ Ñ€Ð¾Ð»Ð¸" />
                                        
                                        <Grid ColumnDefinitions="Auto,Auto" ColumnSpacing="8">
                                            <TextBox Grid.Column="0"
                                                     Width="80"
                                                     Text="{Binding Strength, Mode=TwoWay}"
                                                     Watermark="Ð¡Ð¸Ð»Ð°" />
                                            <Button Grid.Column="1"
                                                    Content="Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ"
                                                    Command="{Binding DeleteCommand}"
                                                    Padding="12,6" />
                                        </Grid>

                                        <ItemsControl ItemsSource="{Binding Privileges}">
                                            <ItemsControl.ItemsPanel>
                                                <ItemsPanelTemplate>
                                                    <WrapPanel Orientation="Horizontal" />
                                                </ItemsPanelTemplate>
                                            </ItemsControl.ItemsPanel>
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate x:DataType="viewModels:RolePrivItemViewModel">
                                                    <CheckBox IsChecked="{Binding IsSelected, Mode=TwoWay}"
                                                              Content="{Binding Name}"
                                                              Margin="0,0,8,4" />
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </StackPanel>
            </Border>

            <!-- ÐŸÑ€Ð¾ÐµÐºÑ‚Ñ‹ (Ð³Ñ€Ð°Ñ„ Ð·Ð°Ð´Ð°Ñ‡) -->
            <views:GraphCanvas Grid.Row="1" Grid.Column="0"
                               Graph="{Binding SelectedGraph}"
                               DataContext="{Binding}"
                               IsVisible="{Binding IsProjectsTab}" />

            <Border Grid.Row="2" Grid.Column="1"
                    Background="#141414"
                    Padding="2 0 0 0"
                    BorderBrush="#3F3F46" 
                    BorderThickness="1,0,0,0">
                <views:TaskEditorView DataContext="{Binding TaskEditor}" />
            </Border>

            <!-- Ð ÐµÑÑƒÑ€ÑÑ‹ -->
            <Border Grid.Row="1" Grid.ColumnSpan="2"
                    Background="#141414"
                    Padding="10"
                    IsVisible="{Binding IsResourcesTab}">
                <StackPanel Spacing="10">
                    <StackPanel Orientation="Horizontal" Spacing="10">
                        <TextBlock Text="Ð ÐµÑÑƒÑ€ÑÑ‹" FontSize="18" FontWeight="Bold" Foreground="White" />
                        <Button Content="+ Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ñ€ÐµÑÑƒÑ€Ñ"
                                Command="{Binding AddResourceCommand}" />
                    </StackPanel>

                    <ListBox ItemsSource="{Binding Resources}">
                        <ListBox.ItemTemplate>
                            <DataTemplate x:DataType="viewModels:ResourceViewModel">
                                <Grid ColumnDefinitions="*,Auto,Auto,Auto" Margin="0,0,0,5" ColumnSpacing="10">
                                    <TextBox Grid.Column="0"
                                             Text="{Binding Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                             Watermark="Ð˜Ð¼Ñ Ñ€ÐµÑÑƒÑ€ÑÐ°" />
                                    <TextBox Grid.Column="1"
                                             Width="80"
                                             Text="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                    <Button Grid.Column="2"
                                            Content="ðŸ“Š ÐžÑ‚Ñ‡Ñ‘Ñ‚"
                                            Command="{Binding ShowReportCommand}"
                                            Padding="10,5" />
                                    <Button Grid.Column="3"
                                            Content="Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ"
                                            Command="{Binding DeleteCommand}"
                                            Padding="10,5" />
                                </Grid>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </StackPanel>
            </Border>

            <!-- Ð˜ÑÐ¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»Ð¸ -->
            <Border Grid.Row="1" Grid.ColumnSpan="2"
                    Background="#141414"
                    Padding="10"
                    IsVisible="{Binding IsActorsTab}">
                <StackPanel Spacing="10">
                    <StackPanel Orientation="Horizontal" Spacing="10">
                        <TextBlock Text="Ð˜ÑÐ¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»Ð¸" FontSize="18" FontWeight="Bold" Foreground="White" />
                        <Button Content="+ Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¸ÑÐ¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»Ñ"
                                Command="{Binding AddActorCommand}"
                                IsEnabled="{Binding CanCreateActors}" />
                    </StackPanel>

                    <ListBox ItemsSource="{Binding Actors}">
                        <ListBox.ItemTemplate>
                            <DataTemplate x:DataType="viewModels:ActorViewModel">
                                <Border BorderBrush="#3F3F46" 
                                        BorderThickness="0,0,0,1" 
                                        Padding="0,10"
                                        Margin="0,0,0,5">
                                    <StackPanel Spacing="8">
                                        <TextBox Text="{Binding Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                 Watermark="Ð˜Ð¼Ñ Ð¸ÑÐ¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»Ñ" />
                                        
                                        <TextBlock Text="Ð£Ñ‡Ñ‘Ñ‚Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð´Ð»Ñ Ð²Ñ…Ð¾Ð´Ð°" 
                                                   FontSize="12" 
                                                   Foreground="#888" 
                                                   Margin="0,8,0,4" />
                                        
                                        <Grid ColumnDefinitions="*,*,Auto,Auto" ColumnSpacing="8">
                                            <TextBox Grid.Column="0"
                                                     Text="{Binding Username, Mode=TwoWay}"
                                                     Watermark="Ð˜Ð¼Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ" />
                                            <TextBox Grid.Column="1"
                                                     Text="{Binding Password, Mode=TwoWay}"
                                                     Watermark="ÐŸÐ°Ñ€Ð¾Ð»ÑŒ"
                                                     PasswordChar="â€¢" />
                                            <Button Grid.Column="2"
                                                    Content="Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ"
                                                    Command="{Binding SetCredentialsCommand}"
                                                    Padding="12,6" />
                                            <Button Grid.Column="3"
                                                    Content="Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ"
                                                    Command="{Binding DeleteCommand}"
                                                    Padding="12,6" />
                                        </Grid>
                                        
                                        <TextBlock Text="âœ“ Ð£Ñ‡Ñ‘Ñ‚Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ñ‹" 
                                                   FontSize="11" 
                                                   Foreground="#4CAF50"
                                                   IsVisible="{Binding HasCredentials}" />
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </StackPanel>
            </Border>

        </Grid>

        <!-- Login Popup -->
        <Popup x:Name="LoginPopup"
               IsOpen="{Binding IsLoginPopupOpen, Mode=TwoWay}"
               Placement="Center"
               IsLightDismissEnabled="True">
            <!-- Child Ð±ÑƒÐ´ÐµÑ‚ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½ Ð² code-behind -->
        </Popup>

        <!-- Project Creation Popup -->
        <Popup x:Name="ProjectCreationPopup"
               IsOpen="{Binding IsProjectCreationPopupOpen, Mode=TwoWay}"
               Placement="Center"
               IsLightDismissEnabled="True">
            <!-- Child Ð±ÑƒÐ´ÐµÑ‚ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½ Ð² code-behind -->
        </Popup>

        <!-- Project Editor Popup -->
        <Popup x:Name="ProjectEditorPopup"
               IsOpen="{Binding IsProjectEditorPopupOpen, Mode=TwoWay}"
               Placement="Center"
               IsLightDismissEnabled="True">
            <!-- Child Ð±ÑƒÐ´ÐµÑ‚ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½ Ð² code-behind -->
        </Popup>

        <!-- Resource Report Popup -->
        <Popup x:Name="ResourceReportPopup"
               IsOpen="{Binding IsResourceReportPopupOpen, Mode=TwoWay}"
               Placement="Center"
               IsLightDismissEnabled="True">
            <!-- Child Ð±ÑƒÐ´ÐµÑ‚ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½ Ð² code-behind -->
        </Popup>

        <!-- Task List Popup -->
        <Popup x:Name="TaskListPopup"
               IsOpen="{Binding IsTaskListPopupOpen, Mode=TwoWay}"
               Placement="Center"
               IsLightDismissEnabled="True">
            <!-- Child Ð±ÑƒÐ´ÐµÑ‚ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½ Ð² code-behind -->
        </Popup>

        <!-- Recurring Task Config Popup -->
        <Popup x:Name="RecurringTaskConfigPopup"
               IsOpen="{Binding IsRecurringTaskConfigPopupOpen, Mode=TwoWay}"
               Placement="Center"
               IsLightDismissEnabled="True">
            <!-- Child Ð±ÑƒÐ´ÐµÑ‚ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½ Ð² code-behind -->
        </Popup>

        <!-- Notification Panel -->
        <views:NotificationPanel Grid.RowSpan="2" Grid.ColumnSpan="2"
                                 IsHitTestVisible="False"
                                 VerticalAlignment="Bottom"
                                 HorizontalAlignment="Right"/>
    </Grid>
</Window>
